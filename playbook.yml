---
# I suspect a loop should be used there
# as an iterable there should be tomcat-cluster group
# at each iterate we exclude cluster from apache (againt httpd)
# uplodad the artifact into tomcat node and then adding node to the loadbalancer
# again
- hosts: tomcat-cluster

  roles:
    - role: add_user
      config:
        name: tomcat
        primary_group: tomcat
        id: 1000
        group_id: 1000
        priviliges:
          - "ALL=(ALL) NOPASSWD: ALL"

    - role: deploy_to_tomcat
      uri: "{{deploy_uri}}"
      artifact_path: "{{artifact_path}}"
      deployer: "{{deployer}}"
      deployer_password: "{{deployer_password}}"
      tags: ['deploy']
